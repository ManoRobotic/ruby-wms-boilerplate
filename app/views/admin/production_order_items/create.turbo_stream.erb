<% if @production_order.production_order_items.count == 1 %>
  <%= turbo_stream.replace "no-consecutivos-row", render(ConsecutivoRowComponent.new(item: @production_order_item)) %>
<% else %>
  <%= turbo_stream.append "production_order_items_table_body", render(ConsecutivoRowComponent.new(item: @production_order_item)) %>
<% end %>

<%# Reset the form %>
<%= turbo_stream.replace "consecutivo-modal-body" do %>
  <% new_item = @production_order.production_order_items.build %>
  <% new_item.folio_consecutivo = ProductionOrderItem.generate_folio_consecutivo(@production_order) %>
  <%= render(ConsecutivoFormComponent.new(production_order: @production_order, consecutivo_form: new_item, auto_print: @auto_print)) %>
<% end %>

<%# Close modal ONLY if auto-print is OFF %>
<% unless @auto_print %>
  <%= turbo_stream.action "close", "consecutivo-modal" %>
<% end %>

<script>
  console.log("ðŸŽ¯ TURBO STREAM IS WORKING!");
  
  // Cleanup auto-submit indicator if exists
  const indicator = document.getElementById('auto-submit-indicator');
  if (indicator) indicator.remove();

  // Show success message
  if (window.showToast) {
    window.showToast('success', '', 'Consecutivo creado exitosamente');
  }
</script>


