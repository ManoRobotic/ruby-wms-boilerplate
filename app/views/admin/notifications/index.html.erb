<% if notice.present? %>
  <%= render "shared/succes_alert", notice: notice %>
<% end %>

<div class="w-full px-4 mt-8 mb-8">
  <div class="relative flex flex-col w-full px-6 text-gray-700 bg-white shadow-md lg:px-10 rounded-xl bg-clip-border">
    <div class="relative p-4 text-gray-700 bg-white bg-clip-border">
      <div class="container mx-auto">
        <div class="flex flex-col items-center gap-8 px-4 mb-4 md:flex-row md:items-center md:justify-between">
          <div>
            <h1 class="mt-12 font-sans text-xl font-semibold leading-snug tracking-normal text-center md:text-left text-blue-gray-900">
              Notificaciones
            </h1>
          </div>
          <div class="flex justify-center gap-2 shrink-0 md:w-auto">
            <% if current_user&.unread_notifications_count&.positive? || current_admin&.unread_notifications_count&.positive? %>
              <%= link_to "Marcar todas como leídas", mark_all_read_admin_notifications_path, 
                  method: :post,
                  class: "mt-12 flex items-center gap-3 rounded-lg bg-blue-500 py-2 px-4 text-white font-bold shadow-md hover:shadow-lg focus:opacity-85 active:opacity-85" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <section class="flex flex-col w-full py-16 bg-muted">
      <div class="container mx-auto">
        <div class="space-y-4">
          <% @notifications.each do |notification| %>
            <div class="notification-item bg-white rounded-lg border <%= 'border-l-4 border-l-blue-500 bg-blue-50' unless notification.read? %> shadow-sm p-4"
                 data-controller="notifications"
                 data-notification-id="<%= notification.id %>">
              <div class="flex items-start space-x-4">
                <div class="flex-shrink-0">
                  <% case notification.notification_type %>
                  <% when 'task_assigned' %>
                    <%= icon('fa-solid', 'tasks', class: 'w-6 h-6 text-blue-600') %>
                  <% when 'task_status_changed' %>
                    <%= icon('fa-solid', 'sync-alt', class: 'w-6 h-6 text-green-600') %>
                  <% when 'order_updated' %>
                    <%= icon('fa-solid', 'shopping-cart', class: 'w-6 h-6 text-orange-600') %>
                  <% when 'inventory_alert' %>
                    <%= icon('fa-solid', 'exclamation-triangle', class: 'w-6 h-6 text-yellow-600') %>
                  <% when 'production_order_created' %>
                    <%= icon('fa-solid', 'industry', class: 'w-6 h-6 text-blue-600') %>
                  <% when 'system' %>
                    <%= icon('fa-solid', 'cog', class: 'w-6 h-6 text-purple-600') %>
                  <% else %>
                    <%= icon('fa-solid', 'info-circle', class: 'w-6 h-6 text-gray-600') %>
                  <% end %>
                </div>
                
                <div class="flex-1 min-w-0">
                  <% if notification.action_url.present? %>
                    <%= link_to notification.action_url, 
                        class: "block hover:text-blue-600", 
                        data: { action: "click->notifications#markAsRead" } do %>
                      <h3 class="text-lg font-medium text-gray-900 mb-1">
                        <%= notification.title %>
                      </h3>
                      <p class="text-gray-600 mb-2">
                        <%= notification.message %>
                      </p>
                    <% end %>
                  <% else %>
                    <div data-action="click->notifications#markAsRead" class="cursor-pointer">
                      <h3 class="text-lg font-medium text-gray-900 mb-1">
                        <%= notification.title %>
                      </h3>
                      <p class="text-gray-600 mb-2">
                        <%= notification.message %>
                      </p>
                    </div>
                  <% end %>
                  
                  <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-500">
                      <%= notification.time_ago %>
                    </p>
                    <div class="flex space-x-2">
                      <% unless notification.read? %>
                        <%= link_to "Marcar como leída", mark_read_admin_notification_path(notification), 
                            method: :patch,
                            class: "text-sm text-blue-600 hover:text-blue-800" %>
                      <% end %>
                      <%= link_to "Eliminar", admin_notification_path(notification), 
                          method: :delete,
                          data: { confirm: "¿Estás seguro de que deseas eliminar esta notificación?" },
                          class: "text-sm text-red-600 hover:text-red-800" %>
                    </div>
                  </div>
                </div>
                
                <% unless notification.read? %>
                  <div class="flex-shrink-0 unread-indicator">
                    <div class="w-3 h-3 bg-blue-600 rounded-full"></div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
          
          <% if @notifications.empty? %>
            <div class="bg-white rounded-lg border shadow-sm p-8 text-center">
              <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <%= icon('fa-solid', 'bell-slash', class: 'w-12 h-12 text-gray-400') %>
              </div>
              <h3 class="text-lg font-medium text-gray-900 mb-2">No tienes notificaciones</h3>
              <p class="text-gray-600">Las notificaciones aparecerán aquí cuando tengas nuevas actividades.</p>
            </div>
          <% end %>
        </div>
        
        <!-- Pagination -->
        <%= render 'shared/table_pagination', collection: @notifications %>
      </div>
    </section>
  </div>
</div>