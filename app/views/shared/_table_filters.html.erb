<%# 
  Partial para filtros de tabla reutilizable
  Parámetros:
  - filters: array de hashes con la configuración de filtros
  - search_placeholder: texto del placeholder para el buscador
  - form_url: URL para el formulario
%>

<div class="bg-white p-4 rounded-md border border-gray-200 mb-4">
  <%= form_with url: local_assigns[:form_url] || request.path, method: :get, local: true, class: "space-y-4" do |form| %>
    
    <!-- Search Field -->
    <% if local_assigns[:search_placeholder] %>
      <div>
        <%= form.text_field :search, 
            value: params[:search], 
            placeholder: local_assigns[:search_placeholder],
            class: "w-full px-3 py-2.5 text-base border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
    <% end %>

    <!-- Filters -->
    <% unless (local_assigns[:filters] || []).empty? %>
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
        <% (local_assigns[:filters] || []).each do |filter| %>
          <div>
            <% case filter[:type] %>
            <% when 'select' %>
              <%= form.select filter[:name], 
                  options_for_select(filter[:options], params[filter[:name]]), 
                  { prompt: filter[:prompt] || filter[:label] },
                  { class: "w-full px-2.5 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white" } %>
            <% when 'date' %>
              <%= form.date_field filter[:name], 
                  value: params[filter[:name]],
                  class: "w-full px-2.5 py-2 text-sm border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500" %>
            <% when 'checkbox' %>
              <div class="flex items-center py-2">
                <%= form.check_box filter[:name], 
                    { checked: params[filter[:name]] == '1' },
                    '1', '0',
                    class: "h-4 w-4 rounded text-blue-600 focus:ring-blue-500 border-gray-300" %>
                <span class="ml-2 text-sm text-gray-700"><%= filter[:label] %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Action Buttons -->
    <div class="flex gap-2 justify-end">
      <%= form.submit "Filtrar", 
          class: "bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 focus:ring-1 focus:ring-blue-500 transition-colors" %>
      <%= link_to "Limpiar", request.path, 
          class: "bg-gray-500 text-white px-4 py-2 rounded-md text-sm hover:bg-gray-600 focus:ring-1 focus:ring-gray-500 transition-colors" %>
    </div>

    <!-- Preserve other params -->
    <% params.except(:search, :controller, :action, :commit, :page, *(local_assigns[:filters] || []).map { |f| f[:name] }).each do |key, value| %>
      <%= form.hidden_field key.to_sym, value: value %>
    <% end %>

  <% end %>
</div>