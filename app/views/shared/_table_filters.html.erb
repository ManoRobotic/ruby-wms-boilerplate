<%# 
  Partial para filtros de tabla reutilizable
  Parámetros:
  - filters: array de hashes con la configuración de filtros
  - search_placeholder: texto del placeholder para el buscador
  - form_url: URL para el formulario
%>

<div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6">
  <%= form_with url: local_assigns[:form_url] || request.path, method: :get, local: true, class: "space-y-4 md:space-y-0 md:flex md:items-end md:space-x-4" do |form| %>
    
    <!-- Search Field -->
    <% if local_assigns[:search_placeholder] %>
      <div class="flex-1">
        <label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label>
        <%= form.text_field :search, 
            value: params[:search], 
            placeholder: local_assigns[:search_placeholder],
            class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>
    <% end %>

    <!-- Dynamic Filters -->
    <% (local_assigns[:filters] || []).each do |filter| %>
      <div class="flex-shrink-0">
        <label class="block text-sm font-medium text-gray-700 mb-1"><%= filter[:label] %></label>
        <% case filter[:type] %>
        <% when 'select' %>
          <%= form.select filter[:name], 
              options_for_select(filter[:options], params[filter[:name]]), 
              { prompt: filter[:prompt] || 'Todos' },
              { class: "px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" } %>
        <% when 'date' %>
          <%= form.date_field filter[:name], 
              value: params[filter[:name]],
              class: "px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
        <% when 'checkbox' %>
          <div class="flex items-center pt-6">
            <%= form.check_box filter[:name], 
                { checked: params[filter[:name]] == '1' },
                '1', '0',
                class: "rounded text-blue-600 focus:ring-blue-500" %>
            <span class="ml-2 text-sm text-gray-700"><%= filter[:label] %></span>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Action Buttons -->
    <div class="flex space-x-2 pt-6 md:pt-0">
      <%= form.submit "Filtrar", 
          class: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors" %>
      <%= link_to "Limpiar", request.path, 
          class: "bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors" %>
    </div>

    <!-- Preserve other params -->
    <% params.except(:search, :controller, :action, :commit, :page, *(local_assigns[:filters] || []).map { |f| f[:name] }).each do |key, value| %>
      <%= form.hidden_field key.to_sym, value: value %>
    <% end %>

  <% end %>
</div>